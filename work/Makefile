PROJECT_TARGET		:= D7000
PROJECT_NAME		:= ancistrus

CUR_PATH		:= $(shell pwd)
RULES			:= $(CUR_PATH)/Rules.mak
export NUMTHREAD	:= $$((2 * `getconf _NPROCESSORS_ONLN 2>/dev/null || echo 1`))
#export NUMTHREAD	:= $$((2 * `grep processor /proc/cpuinfo | wc -l`))

ifdef LOCAL
export LOCAL
endif

ifdef DEBUG
export DEBUG
endif

ifndef PREFIX_NAME
PREFIX_NAME		:= $(PROJECT_NAME)_target
endif

ifndef DEBUG_DIR
DEBUG_DIR		:= /home/ftp
endif

ifneq "$(or $(LOCAL),$(DEBUG))" ""
PREFIX_PATH		:= $(DEBUG_DIR)
else
PREFIX_PATH		:= $(CUR_PATH)/../$(PREFIX_NAME)
endif

BUILTINLIB		:=
BUILTIN			:=
THIRDPARTYLIB		:=
THIRDPARTY		:=
SUBDIRS			:=

#BUILTINLIB 		+= nvram
#THIRDPARTY		+= $(PROJECT_NAME)_core-0.0.0
ifndef LOCAL
#BUILTIN			+= utelnetd-0.1.9
BUILTIN			+= iproute2-4.10.0
THIRDPARTY		+= qos-0.0.0
endif

SUBDIRS			+= $(BUILTINLIB)
SUBDIRS			+= $(THIRDPARTYLIB)
SUBDIRS			+= $(BUILTIN)
SUBDIRS			+= $(THIRDPARTY)


all:    creat_rules
	@for i in $(SUBDIRS) ; do echo -e "\\e[35mapps: make \\e[36m$$i \\e[0m"; $(MAKE) -j$(NUMTHREAD) -C $$i || exit 1; done

clean:
	@for i in $(SUBDIRS) ; do echo -e "\\e[35mapps: clean \\e[36m$$i \\e[0m"; $(MAKE) -j$(NUMTHREAD) -C $$i clean  || exit 1; done

install:
	@for i in $(SUBDIRS) ; do echo -e "\\e[35mapps: install \\e[36m$$i \\e[0m"; $(MAKE) -j$(NUMTHREAD) -C $$i install  || exit 1; done

creat_rules:
	@echo "# Automatically generated by Makefile: don't edit" > $(RULES)
	@echo "export PROJECT		:= $(PROJECT_TARGET)" >> $(RULES)
	@echo "export GIT_NAME		:= $(PROJECT_NAME)" >> $(RULES)
	@echo "export WORK_DIR		:= $(CUR_PATH)" >> $(RULES)
	@echo "export PREFIX		:= $(PREFIX_PATH)" >> $(RULES)
	@cd ../$(PROJECT_TARGET)*_src; echo "export SOURCE_PATH	:= `pwd`" >> $(RULES)
	@echo "include \$$(WORK_DIR)/env.mak" >> $(RULES)
	@echo "include \$$(SOURCE_PATH)/Source/Builds/\$$(PROJECT).mak" >> $(RULES)

